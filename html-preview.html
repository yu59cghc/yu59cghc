<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ€¥æ•‘èª¿æ´¾ç³»çµ±</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; margin: 20px; }
    h1 { text-align: center; color: #d32f2f; }
    .section { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #eee; }
    .btn { background: #d32f2f; color: #fff; padding: 6px 12px; border: none; cursor: pointer; margin: 2px; }
    .btn:hover { background: #b71c1c; }
    input, select { padding: 6px; margin: 4px; }
    .note { color: #555; font-size: 14px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>äººæ‰‹åŠç‰©è³‡èª¿æ´¾ç³»çµ±</h1>

  <!-- æ–°å¢çµ„åˆ¥ -->
  <div class="section">
    <h2>æ–°å¢çµ„åˆ¥</h2>
    <form id="addGroupForm">
      æ–°çµ„åˆ¥åç¨±ï¼š<input type="text" id="newGroup" required>
      <button type="submit" class="btn">æ–°å¢çµ„åˆ¥</button>
    </form>
  </div>

  <!-- æ›´æ”¹çµ„åˆ¥åç¨± -->
  <div class="section">
    <h2>æ›´æ”¹çµ„åˆ¥åç¨±</h2>
    <form id="renameGroupForm">
      åŸçµ„åˆ¥ï¼š
      <select id="oldGroup"></select>
      æ–°åç¨±ï¼š<input type="text" id="renameGroup" required>
      <button type="submit" class="btn">æ›´æ”¹åç¨±</button>
    </form>
  </div>

  <!-- æ–°å¢äººå“¡ -->
  <div class="section">
    <h2>æ–°å¢äººå“¡</h2>
    <form id="addStaffForm">
      å§“åï¼š<input type="text" id="name" required>
      å°ˆé•·ï¼š<input type="text" id="skill" required>
      åˆ†çµ„ï¼š
      <select id="group"></select>
      <button type="submit" class="btn">æ–°å¢</button>
    </form>
    <p class="note">ğŸ“± æç¤ºï¼šè³‡æ–™æœƒä¿å­˜åœ¨ç€è¦½å™¨ localStorageï¼Œä¸‹æ¬¡æ‰“é–‹ä¾ç„¶å­˜åœ¨ã€‚</p>
  </div>

  <!-- äººå“¡èª¿æ´¾ -->
  <div class="section">
    <h2>äººå“¡èª¿æ´¾</h2>
    ç¯©é¸çµ„åˆ¥ï¼š
    <select id="filterGroup" onchange="filterStaff()">
      <option value="å…¨éƒ¨">å…¨éƒ¨</option>
    </select>
    ç¯©é¸ç‹€æ…‹ï¼š
    <select id="filterStatus" onchange="filterStaff()">
      <option value="å…¨éƒ¨">å…¨éƒ¨</option>
      <option value="å¾…å‘½">å¾…å‘½</option>
      <option value="å·¥ä½œä¸­">å·¥ä½œä¸­</option>
      <option value="å·²å®Œæˆ">å·²å®Œæˆ</option>
    </select>
    <table id="staffTable">
      <tr><th>å§“å</th><th>å°ˆé•·</th><th>åˆ†çµ„</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr>
    </table>
    <button class="btn" onclick="clearAll()">æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
  </div>

<script>
let staffList = JSON.parse(localStorage.getItem("staffList")) || [];
let groups = JSON.parse(localStorage.getItem("groups")) || ["Açµ„","Bçµ„","Cçµ„"];

function renderGroups() {
  const groupSelect = document.getElementById("group");
  const oldGroupSelect = document.getElementById("oldGroup");
  const filterGroupSelect = document.getElementById("filterGroup");
  groupSelect.innerHTML = "";
  oldGroupSelect.innerHTML = "";
  filterGroupSelect.innerHTML = "<option value='å…¨éƒ¨'>å…¨éƒ¨</option>";
  groups.forEach(g => {
    let opt1 = document.createElement("option");
    opt1.value = g; opt1.innerText = g;
    groupSelect.appendChild(opt1);
    let opt2 = document.createElement("option");
    opt2.value = g; opt2.innerText = g;
    oldGroupSelect.appendChild(opt2);
    let opt3 = document.createElement("option");
    opt3.value = g; opt3.innerText = g;
    filterGroupSelect.appendChild(opt3);
  });
}

function filterStaff() {
  const selectedGroup = document.getElementById("filterGroup").value;
  const selectedStatus = document.getElementById("filterStatus").value;
  const table = document.getElementById("staffTable");
  table.innerHTML = "<tr><th>å§“å</th><th>å°ˆé•·</th><th>åˆ†çµ„</th><th>ç‹€æ…‹</th><th>æ“ä½œ</th></tr>";
  staffList.forEach((staff, index) => {
    if ((selectedGroup === "å…¨éƒ¨" || staff.group === selectedGroup) &&
        (selectedStatus === "å…¨éƒ¨" || staff.status === selectedStatus)) {
      const row = table.insertRow();
      row.insertCell(0).innerText = staff.name;
      row.insertCell(1).innerText = staff.skill;
      row.insertCell(2).innerText = staff.group;
      const statusCell = row.insertCell(3);
      statusCell.innerText = staff.status;
      const actionCell = row.insertCell(4);
      actionCell.innerHTML = `
        <button class="btn" onclick="dispatch(${index})">æ´¾é£</button>
        <button class="btn" onclick="complete(${index})">å®Œæˆ</button>
        <button class="btn" onclick="standby(${index})">å¾…å‘½</button>
        <button class="btn" onclick="removeStaff(${index})">åˆªé™¤</button>
      `;
    }
  });
}

function addStaff(name, skill, group) {
  staffList.push({ name, skill, group, status: "å¾…å‘½" });
  localStorage.setItem("staffList", JSON.stringify(staffList));
  filterStaff();
}

function dispatch(index) {
  staffList[index].status = "å·¥ä½œä¸­";
  localStorage.setItem("staffList", JSON.stringify(staffList));
  filterStaff();
}
function complete(index) {
  staffList[index].status = "å·²å®Œæˆ";
  localStorage.setItem("staffList", JSON.stringify(staffList));
  filterStaff();
}
function standby(index) {
  staffList[index].status = "å¾…å‘½";
  localStorage.setItem("staffList", JSON.stringify(staffList));
  filterStaff();
}
function removeStaff(index) {
  staffList.splice(index, 1);
  localStorage.setItem("staffList", JSON.stringify(staffList));
  filterStaff();
}
function clearAll() {
  staffList = [];
  groups = ["Açµ„","Bçµ„","Cçµ„"];
  localStorage.removeItem("staffList");
  localStorage.removeItem("groups");
  renderGroups();
  filterStaff();
}

// æ–°å¢çµ„åˆ¥
document.getElementById("addGroupForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const newGroup = document.getElementById("newGroup").value;
  if (!groups.includes(newGroup)) {
    groups.push(newGroup);
    localStorage.setItem("groups", JSON.stringify(groups));
    renderGroups();
    filterStaff(); // ç¢ºä¿ç«‹å³åˆ·æ–°è¡¨æ ¼
  }
  this.reset();
});

// æ›´æ”¹çµ„åˆ¥åç¨±
document.getElementById("renameGroupForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const oldGroup = document.getElementById("oldGroup").value;
  const newName = document.getElementById("renameGroup").value;
  const idx = groups.indexOf(oldGroup);
  if (idx !== -1) {
    groups[idx] = newName;
    staff
